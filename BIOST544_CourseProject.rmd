---
title: "BIOST 544A Course Project: WHO Life Expectancy"
author: "My-Anh Doan and Katie Denecke"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
editor_options:
  chunk_output_type: console
---

| 1. Introduction
|    1.1 Data description
|    1.2 Analysis questions and aims
|    1.3 Analysis approach
| 2. Setup
|    2.1 Load packages and data
|    2.2 Data cleaning
| 3. Initial data analysis
|    3.1 Section
| 4. Main data analysis
|    4.1 Section
| x. Results and interpretations?

# 1. Introduction
[???]Short intro about aims of this report and the data set used for this project.

## 1.1 Data description
[???]List the variables of interest in the dataset in a table
What is the response variable. What are the predictors

## 1.2 Analysis questions and aims
The dataset aims to answer the following questions: 

1. Does various predicting factors which has been chosen initially really affect the Life expectancy? What are the predicting variables actually affecting the life expectancy?

4. Does Life Expectancy has positive or negative correlation with eating habits, lifestyle, exercise, smoking, drinking alcohol etc.
5. What is the impact of schooling on the lifespan of humans?
6. Does Life Expectancy have positive or negative relationship with drinking alcohol?
7. Do densely populated countries tend to have lower life expectancy?
8. What is the impact of Immunization coverage on life Expectancy?

## 1.3 Analysis approach
[???]Describe the proposed approach for the analysis. What tests and techniques are we using?

# 2. Load, clean, and prepare data for analysis
```{r message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(janitor) # Data cleaning package

# Load data
data <- read.csv("./data/Life Expectancy Data.csv")

data <- data %>%
  clean_names() %>% 
  select(-c(country, year)) %>% 
  mutate(status = recode(factor(status, levels = c("Developed", "Developing")),
                         "Developed" = 1, "Developing" = 0)) %>% 
  mutate_all(as.numeric)

str(data)
```

# 3. Initial exploration of data

## 3.1 Handling missing data in predictor variables
```{r message=FALSE, warning=FALSE, include=FALSE}
library(naniar)
library(missForest)

# Check for any observations/rows with missing data
sum(complete.cases(data) == FALSE) / nrow(data)    # proportion of missing data
missing_vals <- which(complete.cases(data) == FALSE)    # rows with missing data

# Visualization of missing values
gg_miss_var(data, show_pct = TRUE)

# Impute missing values in covariates

set.seed(1001)
data_imputed_covars <- missForest(xmis = subset(data, select = -c(life_expectancy)),
                                  maxiter = 50)$ximp

data_imputed <- cbind(data$life_expectancy, data_imputed_covars)
colnames(data_imputed)[1] = "life_expectancy"

# Plot missingness again to validate imputation results
gg_miss_var(data_imputed, show_pct = TRUE)

# Confirm the proportion of missingness in the response variable
100 * sum(is.na(data$life_expectancy)) / nrow(data) # 0.3404% missing; value matches gg_miss_var plot
```

## 3.2 Linear regression model fitting
```{r message=FALSE, warning=FALSE, include=FALSE}
library(car)

lm_all <- lm(life_expectancy ~ ., data = data_imputed)
summary(lm_all)
vif(lm_all)

# Perform stepwise forward selection using AIC as selection criteria
lm_intercept_only <- lm(life_expectancy ~ 1 , data = data_imputed)
summary(lm_intercept_only)
  
forward_AIC <- step(lm_intercept_only, scope = formula(lm_all),
                    direction = "forward", trace = 0, k = 2)
forward_AIC$anova
forward_AIC$coefficients

# Perform stepwise forward selection using BIC as selction criteria
forward_BIC <- step(lm_intercept_only, scope = formula(lm_all),
                    direction = "forward", trace = 0, k = log(nrow(data_imputed)))
forward_BIC$anova
forward_BIC$coefficients

anova(forward_AIC, lm_all)
```

# Results and interpretations
```{r message=FALSE, warning=FALSE, include=FALSE}

```


